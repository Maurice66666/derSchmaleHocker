<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Lampensteuerung</title>
</head>
<body>
  <h1>Lampensteuerung</h1>
  <p>
    Klicke zuerst auf <b>Verbinden</b>, um die Verbindung herzustellen.<br>
    Danach kannst du <b>Lampe An</b>, <b>Lampe Aus</b>, <b>Warmlicht</b> und <b>Kaltlicht</b> steuern.
  </p>
  
  <button onclick="connectBLE()">Verbinden</button>
  <button onclick="lampOn()">Lampe An</button>
  <button onclick="lampOff()">Lampe Aus</button>
  <button onclick="warmlicht()">Warmlicht</button>
  <button onclick="kaltlicht()">Kaltlicht</button>
  
  <script>
    // UUIDs müssen exakt mit denen im ESP32-Code übereinstimmen!
    const SERVICE_UUID = "12345678-1234-1234-1234-1234567890ab";
    const CHARACTERISTIC_UUID = "87654321-4321-4321-4321-ba0987654321";

    let lampCharacteristic;  // Speichert das BLE-Characteristic-Objekt

    // Verbindung herstellen
    async function connectBLE() {
      try {
        const device = await navigator.bluetooth.requestDevice({
          filters: [{ services: [SERVICE_UUID] }]
        });
        const server = await device.gatt.connect();
        const service = await server.getPrimaryService(SERVICE_UUID);
        lampCharacteristic = await service.getCharacteristic(CHARACTERISTIC_UUID);
        alert("Verbunden mit der Lampe!");
      } catch (error) {
        console.error(error);
        alert("Fehler beim Verbinden: " + error);
      }
    }

    // Lampe An: Schickt Byte 1 (Standard: Kaltlicht an)
    async function lampOn() {
      if (!lampCharacteristic) {
        alert("Bitte zuerst auf 'Verbinden' klicken.");
        return;
      }
      await lampCharacteristic.writeValue(new Uint8Array([1]));
      alert("Lampe An (Kaltlicht) gesendet.");
    }

    // Lampe Aus: Schickt Byte 0
    async function lampOff() {
      if (!lampCharacteristic) {
        alert("Bitte zuerst auf 'Verbinden' klicken.");
        return;
      }
      await lampCharacteristic.writeValue(new Uint8Array([0]));
      alert("Lampe Aus gesendet.");
    }

    // Warmlicht: Schickt Byte 2
    async function warmlicht() {
      if (!lampCharacteristic) {
        alert("Bitte zuerst auf 'Verbinden' klicken.");
        return;
      }
      await lampCharacteristic.writeValue(new Uint8Array([2]));
      alert("Warmlicht gesendet.");
    }

    // Kaltlicht: Schickt Byte 3
    async function kaltlicht() {
      if (!lampCharacteristic) {
        alert("Bitte zuerst auf 'Verbinden' klicken.");
        return;
      }
      await lampCharacteristic.writeValue(new Uint8Array([3]));
      alert("Kaltlicht gesendet.");
    }
  </script>
</body>
</html>

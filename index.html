<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Leuchtensteuerung</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f0f0;
      margin: 0;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
    .container {
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      text-align: center;
      width: 90%;
      max-width: 400px;
    }
    h1 {
      color: #333;
      margin-bottom: 10px;
    }
    p {
      color: #555;
      margin-bottom: 20px;
    }
    button {
      font-size: 1.2em;
      padding: 15px 30px;
      margin: 10px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background: #007BFF;
      color: #fff;
      transition: background 0.3s;
      width: 80%;
      max-width: 300px;
    }
    button:hover {
      background: #0056b3;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Leuchtensteuerung</h1>
    <p>
      Drücke zuerst auf <strong>Verbinden</strong>, um die Verbindung herzustellen.<br>
      Dann kannst Du <strong>Leuchte An</strong>, <strong>Leuchte Aus</strong>, <strong>Warmlicht</strong> und <strong>Kaltlicht</strong> steuern.
    </p>
    <button onclick="connectBLE()">Verbinden</button>
    <button onclick="leuchteOn()">Leuchte An</button>
    <button onclick="leuchteOff()">Leuchte Aus</button>
    <button onclick="warmlicht()">Warmlicht</button>
    <button onclick="kaltlicht()">Kaltlicht</button>
  </div>
  
  <script>
    // UUIDs – müssen exakt mit dem ESP32-Code übereinstimmen!
    const SERVICE_UUID = "12345678-1234-1234-1234-1234567890ab";
    const CHARACTERISTIC_UUID = "87654321-4321-4321-4321-ba0987654321";

    let leuchteCharacteristic;  // Hier wird das BLE-Characteristic-Objekt gespeichert

    async function connectBLE() {
      try {
        const device = await navigator.bluetooth.requestDevice({
          filters: [{ services: [SERVICE_UUID] }]
        });
        const server = await device.gatt.connect();
        const service = await server.getPrimaryService(SERVICE_UUID);
        leuchteCharacteristic = await service.getCharacteristic(CHARACTERISTIC_UUID);
        alert("Verbunden mit der Leuchte!");
      } catch (error) {
        console.error(error);
        alert("Fehler beim Verbinden: " + error);
      }
    }

    // Leuchte An: sendet Byte 1 (Standard: Kaltlicht)
    async function leuchteOn() {
      if (!leuchteCharacteristic) {
        alert("Bitte zuerst auf 'Verbinden' klicken.");
        return;
      }
      await leuchteCharacteristic.writeValue(new Uint8Array([1]));
      alert("Leuchte An (Kaltlicht) gesendet.");
    }

    // Leuchte Aus: sendet Byte 0
    async function leuchteOff() {
      if (!leuchteCharacteristic) {
        alert("Bitte zuerst auf 'Verbinden' klicken.");
        return;
      }
      await leuchteCharacteristic.writeValue(new Uint8Array([0]));
      alert("Leuchte Aus gesendet.");
    }

    // Warmlicht: sendet Byte 2
    async function warmlicht() {
      if (!leuchteCharacteristic) {
        alert("Bitte zuerst auf 'Verbinden' klicken.");
        return;
      }
      await leuchteCharacteristic.writeValue(new Uint8Array([2]));
      alert("Warmlicht gesendet.");
    }

    // Kaltlicht: sendet Byte 3
    async function kaltlicht() {
      if (!leuchteCharacteristic) {
        alert("Bitte zuerst auf 'Verbinden' klicken.");
        return;
      }
      await leuchteCharacteristic.writeValue(new Uint8Array([3]));
      alert("Kaltlicht gesendet.");
    }
  </script>
</body>
</html>
